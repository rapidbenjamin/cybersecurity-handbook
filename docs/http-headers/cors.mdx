---
title: Cross-origin resource sharing (CORS)
sidebar_position: 3
---


# HTTP Header: CORS


![CORS Meme](/img/meme_05.png)
_Image from [Joe Honton | A Series of Unhappy Events in Corslandia](https://medium.com/@joehonton/a-series-of-unhappy-events-in-corslandia-c7e7d1577e9e)_

## What?

<iframe width="100%" height="450"
src="https://www.youtube.com/embed/0IMz8d9Cby4">
</iframe>


![CORS Meme](/img/cors.svg)
_Image from [portswigger | Cross-origin resource sharing (CORS)](https://portswigger.net/web-security/cors)_

> Cross-origin resource sharing (CORS) is a browser mechanism which enables controlled access to resources located outside of a given domain. It extends and adds flexibility to [the same-origin policy (SOP)](https://portswigger.net/web-security/cors/same-origin-policy). However, it also provides potential for cross-domain based attacks, if a website's CORS policy is poorly configured and implemented. CORS is not a protection against cross-origin attacks such as cross-site request forgery (CSRF).
> _by [portswigger | Cross-origin resource sharing (CORS)](https://portswigger.net/web-security/cors)_ 


## The header


In order to manage CORS we need to use several headers that have a common pattern `Access-Control-*`

- `Access-Control-Allow-Origin`: indicates whether the response can be shared with requesting code from the given origin. Valid values (single url, `*` or `null`). [See Documentation](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin)
- `Access-Control-Allow-Credentials`: tells browsers whether to expose the response to frontend JavaScript code when the request's credentials mode (`Request.credentials`) is include. [See Documentation](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials)
- `Access-Control-Allow-Methods`: response header specifies the method or methods allowed when accessing the resource in response to a preflight request. [See Documentation](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Methods)

There are other headers like `Access-Control-Allow-Headers`, `Access-Control-Expose-Headers`, `Access-Control-Max-Age`... used for [CORS preflight requests](https://developer.mozilla.org/en-US/docs/Glossary/preflight_request)

## The code

There is an official Middleware made by the Express team called [CORS](https://www.npmjs.com/package/cors)

### Simple Usage

```js
const express = require('express')
const cors = require('cors')
const app = express()
 
app.use(cors())
 
app.get('/products/:id', (req, res, next) => {
  res.json({msg: 'This is CORS-enabled for all origins!'})
})
 
app.listen(8080, () => {
  console.log('CORS-enabled web server listening on port 80')
})
```

### Configuring CORS w/ Dynamic Origin

```js
const express = require('express')
const cors = require('cors')
const app = express()
 
const whitelist = ['http://example1.com', 'http://example2.com']

const corsOptions = {
  origin: (origin, cb) => {
    whitelist.includes(origin) ? cb(null, true) : cb(new Error('Not allowed by CORS'))
  }
}

app.get('/products/:id', cors(corsOptions), (req, res, next) => {
  res.json({msg: 'This is CORS-enabled for a whitelisted domain.'})
})
 
app.listen(8080, () => {
  console.log('CORS-enabled web server listening on port 80')
})
```

Don't forget to check [the configuration features](https://www.npmjs.com/package/cors#configuration-options)


## Attacks


Most of the CORS attacks are based on generating a response header that allow the attackers to add their malicious domain in the `Access-Control-Allow-Origin`.

In most of the cases this flaws are generated by misconfiguration.


## Solution

- Never use the Request `origin` value as the response `Access-Control-Allow-Origin` value.
- Avoid wildcard validation like `*-website.com`, as the malicious attacks can match the criteria ( `good-website.com`, `evil-website.com`...).
- Avoid to whitelist `null` as valid Origin value in the request header.
- Avoid wildcards in internal networks

### Refs

- [Medium | A Series of Unhappy Events in Corslandia](https://medium.com/@joehonton/a-series-of-unhappy-events-in-corslandia-c7e7d1577e9e)
- [portswigger | Cross-origin resource sharing (CORS)](https://portswigger.net/web-security/cors)
- [MDN |Â CORS preflight requests](https://developer.mozilla.org/en-US/docs/Glossary/preflight_request)
- [MDN | Cross-Origin Resource Sharing (CORS)](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS)
- [html5rocks | Using CORS](https://www.html5rocks.com/en/tutorials/cors/)
