(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{"/WWM":function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return s})),n.d(t,"default",(function(){return l}));n("5hJT"),n("W1QL"),n("K/PF"),n("t91x"),n("75LO"),n("PJhk"),n("mXGw");var r=n("/FXl"),o=n("TjRS");n("aD51");function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var s={};void 0!==s&&s&&s===Object(s)&&Object.isExtensible(s)&&!s.hasOwnProperty("__filemeta")&&Object.defineProperty(s,"__filemeta",{configurable:!0,value:{name:"_frontmatter",filename:"src/http_headers/cors.mdx"}});var i={_frontmatter:s},c=o.a;function l(e){var t=e.components,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,["components"]);return Object(r.b)(c,a({},i,o,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h1",{id:"http-header-cors"},"HTTP Header: CORS"),Object(r.b)("p",null,Object(r.b)("img",{alt:"CORS Meme",src:n("kJIL")}),"\n",Object(r.b)("em",{parentName:"p"},"Image from ",Object(r.b)("a",a({parentName:"em"},{href:"https://medium.com/@joehonton/a-series-of-unhappy-events-in-corslandia-c7e7d1577e9e"}),"Joe Honton | A Series of Unhappy Events in Corslandia"))),Object(r.b)("h2",{id:"what"},"What?"),Object(r.b)("iframe",{width:"100%",height:"450",src:"https://www.youtube.com/embed/0IMz8d9Cby4"}),Object(r.b)("p",null,Object(r.b)("img",{alt:"CORS Meme",src:n("hcok")}),"\n",Object(r.b)("em",{parentName:"p"},"Image from ",Object(r.b)("a",a({parentName:"em"},{href:"https://portswigger.net/web-security/cors"}),"portswigger | Cross-origin resource sharing (CORS)"))),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"Cross-origin resource sharing (CORS) is a browser mechanism which enables controlled access to resources located outside of a given domain. It extends and adds flexibility to ",Object(r.b)("a",a({parentName:"p"},{href:"https://portswigger.net/web-security/cors/same-origin-policy"}),"the same-origin policy (SOP)"),". However, it also provides potential for cross-domain based attacks, if a website's CORS policy is poorly configured and implemented. CORS is not a protection against cross-origin attacks such as cross-site request forgery (CSRF).\n",Object(r.b)("em",{parentName:"p"},"by ",Object(r.b)("a",a({parentName:"em"},{href:"https://portswigger.net/web-security/cors"}),"portswigger | Cross-origin resource sharing (CORS)"))," ")),Object(r.b)("h2",{id:"the-header"},"The header"),Object(r.b)("p",null,"In order to manage CORS we need to use several headers that have a common pattern ",Object(r.b)("inlineCode",{parentName:"p"},"Access-Control-*")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Access-Control-Allow-Origin"),": indicates whether the response can be shared with requesting code from the given origin. Valid values (single url, ",Object(r.b)("inlineCode",{parentName:"li"},"*")," or ",Object(r.b)("inlineCode",{parentName:"li"},"null"),"). ",Object(r.b)("a",a({parentName:"li"},{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin"}),"See Documentation")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Access-Control-Allow-Credentials"),": tells browsers whether to expose the response to frontend JavaScript code when the request's credentials mode (",Object(r.b)("inlineCode",{parentName:"li"},"Request.credentials"),") is include. ",Object(r.b)("a",a({parentName:"li"},{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials"}),"See Documentation")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Access-Control-Allow-Methods"),": response header specifies the method or methods allowed when accessing the resource in response to a preflight request. ",Object(r.b)("a",a({parentName:"li"},{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Methods"}),"See Documentation"))),Object(r.b)("p",null,"There are other headers like ",Object(r.b)("inlineCode",{parentName:"p"},"Access-Control-Allow-Headers"),", ",Object(r.b)("inlineCode",{parentName:"p"},"Access-Control-Expose-Headers"),", ",Object(r.b)("inlineCode",{parentName:"p"},"Access-Control-Max-Age"),"... used for ",Object(r.b)("a",a({parentName:"p"},{href:"https://developer.mozilla.org/en-US/docs/Glossary/preflight_request"}),"CORS preflight requests")),Object(r.b)("h2",{id:"the-code"},"The code"),Object(r.b)("p",null,"There is an official Middleware made by the Express team called ",Object(r.b)("a",a({parentName:"p"},{href:"https://www.npmjs.com/package/cors"}),"CORS")),Object(r.b)("h3",{id:"simple-usage"},"Simple Usage"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-js"}),"const express = require('express')\nconst cors = require('cors')\nconst app = express()\n \napp.use(cors())\n \napp.get('/products/:id', (req, res, next) => {\n  res.json({msg: 'This is CORS-enabled for all origins!'})\n})\n \napp.listen(8080, () => {\n  console.log('CORS-enabled web server listening on port 80')\n})\n")),Object(r.b)("h3",{id:"configuring-cors-w-dynamic-origin"},"Configuring CORS w/ Dynamic Origin"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-js"}),"const express = require('express')\nconst cors = require('cors')\nconst app = express()\n \nconst whitelist = ['http://example1.com', 'http://example2.com']\n\nconst corsOptions = {\n  origin: (origin, cb) => {\n    whitelist.includes(origin) ? cb(null, true) : cb(new Error('Not allowed by CORS'))\n  }\n}\n\napp.get('/products/:id', cors(corsOptions), (req, res, next) => {\n  res.json({msg: 'This is CORS-enabled for a whitelisted domain.'})\n})\n \napp.listen(8080, () => {\n  console.log('CORS-enabled web server listening on port 80')\n})\n")),Object(r.b)("p",null,"Don't forget to check ",Object(r.b)("a",a({parentName:"p"},{href:"https://www.npmjs.com/package/cors#configuration-options"}),"the configuration features")),Object(r.b)("h2",{id:"attacks"},"Attacks"),Object(r.b)("p",null,"Most of the CORS attacks are based on generating a response header that allow the attackers to add their malicious domain in the ",Object(r.b)("inlineCode",{parentName:"p"},"Access-Control-Allow-Origin"),"."),Object(r.b)("p",null,"In most of the cases this flaws are generated by misconfiguration."),Object(r.b)("h2",{id:"solution"},"Solution"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Never use the Request ",Object(r.b)("inlineCode",{parentName:"li"},"origin")," value as the response ",Object(r.b)("inlineCode",{parentName:"li"},"Access-Control-Allow-Origin")," value."),Object(r.b)("li",{parentName:"ul"},"Avoid wildcard validation like ",Object(r.b)("inlineCode",{parentName:"li"},"*-website.com"),", as the malicious attacks can match the criteria ( ",Object(r.b)("inlineCode",{parentName:"li"},"good-website.com"),", ",Object(r.b)("inlineCode",{parentName:"li"},"evil-website.com"),"...)."),Object(r.b)("li",{parentName:"ul"},"Avoid to whitelist ",Object(r.b)("inlineCode",{parentName:"li"},"null")," as valid Origin value in the request header."),Object(r.b)("li",{parentName:"ul"},"Avoid wildcards in internal networks")),Object(r.b)("h3",{id:"refs"},"Refs"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",a({parentName:"li"},{href:"https://medium.com/@joehonton/a-series-of-unhappy-events-in-corslandia-c7e7d1577e9e"}),"Medium | A Series of Unhappy Events in Corslandia")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",a({parentName:"li"},{href:"https://portswigger.net/web-security/cors"}),"portswigger | Cross-origin resource sharing (CORS)")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",a({parentName:"li"},{href:"https://developer.mozilla.org/en-US/docs/Glossary/preflight_request"}),"MDN |Â CORS preflight requests")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",a({parentName:"li"},{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS"}),"MDN | Cross-Origin Resource Sharing (CORS)")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",a({parentName:"li"},{href:"https://www.html5rocks.com/en/tutorials/cors/"}),"html5rocks | Using CORS"))))}void 0!==l&&l&&l===Object(l)&&Object.isExtensible(l)&&!l.hasOwnProperty("__filemeta")&&Object.defineProperty(l,"__filemeta",{configurable:!0,value:{name:"MDXContent",filename:"src/http_headers/cors.mdx"}}),l.isMDXComponent=!0},hcok:function(e,t,n){e.exports=n.p+"static/cors-728e32aad548c0a7b0874cdfda9cd1ea.svg"},kJIL:function(e,t,n){e.exports=n.p+"static/meme_05-d963961847f937d8c033e1e598177c73.png"}}]);
//# sourceMappingURL=component---src-http-headers-cors-mdx-168719c4c8abbd905dd7.js.map